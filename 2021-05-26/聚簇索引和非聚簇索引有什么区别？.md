## 聚簇索引和非聚簇索引有什么区别？
### 什么是聚簇索引
MySQL中每一个InnoDB的表都需要一个聚簇索引（clustered index）。如果这张表定义了主键，那么聚簇索引就是主键；如果没定义主键，那么MySQL会把找到的第一个**非空唯一**索引作为主键；如果合适的唯一索引也没找到，那么MySQL会在内部生成一个隐藏的字段（row id），并在上面建立聚簇索引。

### 聚簇索引和非聚簇索引的区别
- 聚簇索引是按所选字段组织顺序，但是叶子节点也也含其他所有的字段。
- 非聚簇索引，除了包含所在字段的数据，还包含主键的key。如果需要查询索引以外的字段，会使用主键的key去聚簇索引取，俗称“回表”。

假设现在有一个非聚簇索引(name,age)，有以下查询

```
select name,age,sex,address from user where name='LiSi';
```

MySQL在通过索引(name,age)找到name为LiSi的数据后，在当前的索引只能拿到name、age以及主键三个字段，还缺少sex、address字段，这时候就需要通过主键映射到聚簇索引上对应的数据行，拿到sex和address两个字段。

### 如何有效利用聚簇索引
1、小的主键。通常来说，都推荐使用一个小的字段作为主键。因为主键作为聚簇索引，会在所有非聚簇索引里存储，所以小的主键能节省更多空间。比如自增的整型字段就很适合作为主键。

2、覆盖索引（covering index）。非聚簇索引可能存在的“回表”，会导致查询多一次磁盘IO，需要尽量避免。例如，根据查询建立索引，尽可能覆盖到慢查询用到的字段，还是上面那个查询

```
select name,age,sex,address from user where name='LiSi';
```

就可以通过建立(name,age,sex,address)索引防止“回表”。也叫覆盖索引。当然这样做的缺点也很明显，就是索引占用空间会剧增，所以这里也只建议针对慢查询才去做这样的优化。业务中还是需要根据实际的场景去权衡，要不要这样用空间换时间。