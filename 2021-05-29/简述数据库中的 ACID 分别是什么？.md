## 简述数据库中的 ACID 分别是什么？
>ACID模型由一系列数据库设计准则组成，注重数据的可靠性（reliability）。以下通过MySQL来说明。

MySQL可以在软件崩溃或者硬件故障的时候依然保证数据不被损坏，是因为有遵循ACID而设计的组件，如InnoDB存储引擎。如果你的系统遵循ACID，那么就不需要为了数据的一致性检查和崩溃恢复，做额外的工作。另外，如果你有其他软件或硬件上的安全机制，或者你的应用可以忍受小部分的数据丢失和不一致。也可以通过调整MySQL设置，牺牲一部分ACID带来的可靠性，来换取更好的性能和吞吐量。ACID分别有以下含义：

- A：atomic原子性
- C：consistency一致性
- I：isolation隔离性
- D：durability持久化

### A 原子性
MySQL中原子性主要由InnoDB事务保证。在同一个事务中，如果有多处数据修改（如更新了多张表的数据），要么事务提交，所有修改成功执行；要么事务回滚，所有修改都不执行。
### C 一致性
MySQL的一致性保护数据不受崩溃（crashes）影响，主要通过InnoDB的内部机制实现，包括：

- InnoDB两次写buffer（Doublewrite Buffer）
- InnoDB 崩溃恢复机制

### I 隔离性
隔离性主要由事务提供，InnoDB中事务有4个级别，隔离程度从低到高如下：

- 读未提交（Read Uncommitted）事务对数据的变更，在提交前就能被其他事务看到
- 读提交（Read Committed）事务提交后，它对数据的变更才能被其他事务看到
- 可重复读（Repeatable Read）一个事务执行过程中看到的数据，总是跟这个事务启动时看到的数据是一致的。
- 串行化（Serializable）事务串行执行。对同一行数据，读会加读锁，写会加写锁。出现读写锁冲突时，后来的事务必须等前一个事务执行完成后，才能继续执行。

假如下面的表，按时间顺序执行以下两个事务：

```
mysql> create table T(c int) engine=InnoDB;
insert into T(c) values(1);
```

|事务A|事务B|
|:--|:--|
|启动事务，查询得到值1|启动事务|
||查询得到值1|
||将1改成2|
|查询得到值V1||
||提交事务B|
|查询得到值V2||
|提交事务A||
|查询得到值V3||

在不同的隔离隔壁级别下，事务A会有不同的返回结果，也就是V1、V2、V3会得到不同的值。

- 如果隔离级别为读未提交，V1的值是2，**因为事务B虽然没提交，但是已经被A看到了**，因此，V2，V3的值也都是2。
- 如果隔离级别为读提交，V1的值是1，**事务B的更新在提交后才能被A看到**，所以V2，V3的值是2。
- 如果隔离级别是可重复读，V1，V2的值都是1，V3时。之所以V2还是1，**就是因为遵循了这个要求：事务在执行期间看到的数据必须是前后一致的**。
- 如果隔离级别为串行化，在事务B执行“将1改成2”的时候，会被锁住。直到A提交后，才能继续执行。所以在A看来，V1，V2是1，V3是2。

### D 持久性
指内存中的数据能保存到磁盘等相对可靠的存储设备上。影响MySQL持久性的因素较多，包括以下：

- Doublewrite Buffer
- ``` innodb_flush_log_at_trx_commit ```参数的设置
- ``` sync_binlog  ```参数的设置
- ``` innodb_file_per_table  ```参数的设置
- 存储设备的write buffer，如磁盘驱动或者SSD
- 运行MySQL的操作系统是否支持```fsync()```系统调用
- 运行MySQL和存储数据的服务器，是否有不间断电源机制（UPS，uninterruptible power supply）防止断电。
- 你的备份策略，如备份的类型和频率、周期。
- 如果是分布式系统，还要看数据中心之间网络连接和硬件等等情况。