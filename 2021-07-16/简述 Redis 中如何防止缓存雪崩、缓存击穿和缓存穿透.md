## 简述 Redis 中如何防止缓存雪崩、缓存击穿和缓存穿透

### 缓存雪崩
Redis中key大面积同时过期，高峰期会导致流量冲垮数据库。
#### 导致原因

- Redis宕机。
- 大量key设置了相同的过期时间。

#### 针对宕机的方案

- Redis高可用：集群部署，主从+哨兵。
- RDB+AOF持久化策略。
- 提高数据库并发能力：读写分离，分库分表等。

#### 针对过期时间相同的方案

- 设置定时时间时加上随机值。

### 缓存击穿
类似于缓存雪崩，但是缓存击穿是专指**热key**，它失效的瞬间大流量把数据库冲垮。
#### 导致原因

- 热key失效。
- 数据库没有限流。

#### 解决方案

- 设置热key永不过期，但是只能处理提前分析出来的热key。
- 限流、降级，流量达到阈值对服务降级（如令牌的桶算法，Java的Semaphore）。牺牲小部分服务可用换取大部分服务可用。


### 缓存穿透
大量请求查询Redis不存在的key，导致大量请求打到数据库。
#### 导致原因

- 参数校验没考虑周全，没拦截到无效参数。
- 恶意攻击。

#### 解决方案

- 做好用户鉴权、参数校验
- 使用布隆过滤器。

### 布隆过滤器
布隆过滤器（Bloom Filter）本质上是由长度为 m 的位向量或位列表（仅包含 0 或 1 位值的列表）组成，最初所有的值均设置为 0。
#### 布隆过滤器原理

- 使用k个哈希函数生成多个哈希值，分别会将k个位置为1。
- 如果查询的key，k个哈希函数计算出来的位中，有至少一个为0，那么肯定不存在；如果全是1，则可能存在。

#### 布隆过滤器优点

- 高性能

#### 布隆过滤器缺点

- 只能确认哪些key不存在，不能确认哪些key一定存在。

#### 布隆过滤器使用场景

- 网页爬虫对URL去重
- 反垃圾邮件
- 识别恶意URL
- 避免推荐已读过的文章
- 缓存穿透

