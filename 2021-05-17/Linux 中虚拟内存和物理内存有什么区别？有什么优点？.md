## Linux 中虚拟内存和物理内存有什么区别？有什么优点？
软件在操作系统运行需要内存。但是物理内存是有限的，所以如果给所有软件分配内存，有以下方法：

方案一、让软件自己声明需要多少内存，然后使用多少。

- 优点：应用都被预先分配好内存位置（memory slot）了，需要用的时候可以马上使用。
- 缺点1：这方案不是可拓展的（scale），预先分配的内存有多少就是多少。
- 缺点2：让软件自由分配可能会造成内存互相覆盖，比如软件A分配了0~1023的内存端，软件B分配了1000~1768的内存端，存储在1000~1023的数据会有被另一个软件覆盖的风险。

方案二、操作系统来管理内存，软件需要使用的时候，向操作系统申请。

- 优点1：避免了内存覆盖；
- 优点2：相比方案一可拓展性好很多。
- 缺点1：应用退出后会归还内存，造成内存碎片，虽然可以通过压缩（compaction）技术合并碎片化内存，但是压缩操作需要移动其他内存空间，这些空间可能被正在运行的软件使用着。所以压缩操作性能上非常昂贵。
- 缺点2：即使压缩了内存退出带来的内存碎片，在应用使用中，也可能存在有时候不需要那么多内存的时候，这时候也是需要通过压缩来“缩容”的。比如说，我使用爱奇艺看《阿凡达》，这时候会使用非常多的内存。看完之后我最小化爱奇艺，切换到浏览器刷Leetcode，这时候爱奇艺是可以释放很多不用的内存。如果要压缩这部分不用的内存，就又涉及到移动正在被使用的内存空间了。

虚拟地址空间（也叫虚拟内存）就是为了解决这个问题诞生的。物理内存通过页表（Page Table）将物理地址分块映射到虚拟内存。每块对应页表里的一页（page），通常一页大小为4KB。当有软件申请使用内存而没有多余的空闲内存页时，会淘汰一页数据（选择哪一页的算法可能是LRU，也可能是先进先出），来“腾”出空间给申请内存的程序。这样一来，再也不需要压缩内存空间这种昂贵的操作来腾出内存了，现在只需要移动一“页”的数据即可满足新的内存请求。

所以，虚拟内存技术有以下优点：

- 软件申请不再受物理内存限制。因为操作系统可以通过淘汰算法，不断地将闲置的（可能是应用退出或者空闲时段释放的）内存页淘汰，然后提供给新的内存请求。
- 应用闲置或者退出造成的内存碎片，也以“页”的形式循环使用，解决了内存碎片化问题。
- 操作系统负责管理实际的物理内存，应用无需关心其细节，也不再需要担心申请的内存段和其他应用重叠，导致数据互相覆盖的问题。
