## Redis Sentinel可以防止脑裂吗？
### 过程分析
假设有一个三节点的 Sentinel 集群，如下：


```
            +-------------+
            | Sentinel 1  |----- Client A
            | Redis 1 (M) |
            +-------------+
                    |
                    |
+-------------+     |          +------------+
| Sentinel 2  |-----+-- // ----| Sentinel 3 |----- Client B
| Redis 2 (S) |                | Redis 3 (M)|
+-------------+                +------------+
```

- Redis 3 为主节点，但是现在发生了脑裂，节点3与节点1，节点2被隔离在两个网络分区中。
- 分区后节点1被选为新的主节点，但对于部分客户端来说，节点3依然作为 master 并接收写数据的请求。
- 等到网络恢复后，节点3也会更新配置，视节点1为 master。但是脑裂开始到现在这段时间写的数据都会丢失。

### 解决方法
由于 Redis Sentinel 为了追求性能，在主从节点之间使用异步来同步数据。这个问题还没能完全解决，但是可以通过配置尽可能减少丢失的数据。

```
min-replicas-to-write 1
min-replicas-max-lag 10
```

- ```min-replicas-to-write``` 定义了 master 与多少个节点失联之后，就无法再接收写请求。
- ```min-replicas-max-lag 10``` 定义了 master 多长时间（秒）无法得到从节点的响应，就认为这个节点失联。

通过上面配置，master 10秒都得不到一个从节点的响应，认为这个从节点失联，开始不再接收写请求。这样可以防止新旧 master 之间的数据差异过大。