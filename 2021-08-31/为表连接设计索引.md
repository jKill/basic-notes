## 为表连接设计索引
### 表连接处理流程

- 嵌套循环连接（NLJ，最常用的连接方式）中，DBMS首先在外层表找到一行满足过滤条件的记录。
- 然后在内层表查找与这一行数据相关的记录。
- 不断重复以上步骤。

### 为什么连接性能不好

- 仅遵循“在连接字段上建索引”是不够的。如果使用大表做驱动表，依然会产生大量的随机IO。
- 优化器可能选择错误的访问路径。
- 设计表时，盲目坚持“表中不应该有冗余字段”。适当“反范式”地设计冗余字段，可以减少连表大量的随机访问。
- 设计表时，一张表可以实现的功能，使用了多张表。导致查询时有大量多余的表连接。

### 如何优化表连接的索引

- 用能够产生较小结果集的查询作为外层查询（驱动表）。
- 尽量设计设计覆盖索引，较少回表产生的随机访问。
- “反范式化”：将某列拷贝到依赖表并添加到索引。消除对内层表的随机访问。

#### “反范式”的优点

- 优化读性能，减少表连接时大量随机读。

#### “反范式”的缺点

- 维护冗余字段的开销，UPDATE需要移动索引行。产生磁盘的随机访问。这也是数据库读和写性能的权衡。
