## 简述 Redis 持久化中 RDB 以及 AOF 方案的优缺点
RDB的优点：

- RDB文件结构紧凑，适合用来做备份。
- RDB最大化利用了Redis的性能，持久化到时候只需要fork一个子进程，然后子进程会完成剩下的持久化步骤。父进程不会进行任何的磁盘IO
- 相对AOF，RDB支持在大数据集情况下快速重启。
- 对于主从节点来说，RDB支持在重启和故障转移后的部分重同步。

RDB缺点：

- RDB不适合在Redis意外停机后最小化数据丢失。虽然可以配置，但通常使用Redis的系统都是5分钟甚至更久，才创建一个RDB快照。这样一旦意外停机，会丢失最近几分钟的数据。
- RDB需要经常fork()来持久化数据到磁盘。但是数据集比较大或者CPU性能不好的时候，fork()是一个很慢的操作，会导致Redis停止响应客户端几十毫秒、几百毫秒甚至1秒。

AOF优点：

- 使用AOF持久化更灵活：可以根据需要选择不同的fsync策略：1、不主动fsync，完全交给操作系统；2、每秒进行一次fsync；3、每个查询进行一次fsync。默认的策略是每秒fsync一次。
- AOF日志是append only格式的，所以不需要随机查找写入位置，在不断电的情况下也没有corruption问题。即使因为意外（如磁盘满了）导致命令在log中只记录了一半，redis-check-aof工具也能很容易发现。
- AOF文件很大的时候，可以在后台自动重写。新AOF文件会以最少的操作创建当前的数据集，新文件一旦准备好，Redis就会切换过去。
- AOF的日志格式易于理解和解析。如果数据被意外删除了(不小心用了FLUSHALL命令)，可以通过以下步骤恢复：1、停止Redis服务；2、在AOF文件找到误操作的命令，删除掉；3、重启Redis。

AOF缺点：

- 同样的数据集下，AOF文件通常比RDB文件大。
- AOF通常比RDB慢。只有使用”不主动fsync“和”每秒fsync一次“的策略时，才能像RDB一样快。