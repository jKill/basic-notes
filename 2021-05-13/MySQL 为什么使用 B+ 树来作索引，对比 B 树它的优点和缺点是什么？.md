## MySQL 为什么使用 B+ 树来作索引，对比 B 树它的优点和缺点是什么？

MYSQL使用B+树作索引，是为了尽可能减少磁盘（机械硬盘）IO次数。因为大多数选择使用MySQL这类OLTP数据库的业务，都需要事务能力、数据持久化和一定的数据实时查询能力。把B+树作为默认的索引，是兼顾了以上几点之后的选择。

### 相比哈希索引
缺点：

- 哈希索引通过哈希函数定位数据，由于是等值查询，单个数据查找时间复杂度为O(1)。而B+树为O(logN)。

优点：

- 支持范围查询。
- 支持排序。
- 支持部分索引列查询（哈希索引通过所有字段计算哈希值）。

因为局部性原理，操作系统每次从磁盘读取数据都是以”页“为单位的。大多数操作系统一页的大小为4KB，如下：

```
deMacBook-Pro% getconf PAGE_SIZE
4096
```

通常B+树一个节点大小就设计为4K，保证了一次磁盘IO能读取把整个节点的数据读取出来，尽可能保证顺序IO。

#### 顺序IO对比随机IO
从磁盘读取数据相比从内存读取数据要慢很多，由于成本问题，大多数业务还在使用机械硬盘，机械硬盘读取数据需要经过一系列队列，寻道，旋转，传输等过程。

![](https://img.draveness.me/disk-io-cost.png)

上图可以看到，一次查询中，寻道时间通常能达到3~15ms，占比较大。随机IO的特点就是数据离磁头较远，磁头移动到目标数据所在的磁道——也就是寻道时间较大。而顺序IO由于所查找的数据离得很近，磁头几乎不需要移动，寻道时间大大减少，性能通常是随机IO的40倍。


### 相比B树
缺点：

- B树在非叶子节点也存储了数据，数据查找的时间复杂度，最好的情况可以达到O(1)；而B+树不管数据在哪，都需要查找到叶子节点，时间复杂度O(logN)

优点：

- 数据只在叶子节点存储，非叶子节点只存储指针。单个叶子节点能存储更多指针，降低树高，每一次IO能查找更多数据。
- 相邻叶子节点有指针，假设数据集大小K，进行范围查询需要只需要一次随机读和 K 次顺序读，而B树需要 K 次随机读。